<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Contests | GLOBAL-GAMES</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style-gradient.css">
  <style>
    body { background: #101729 !important; }
    .vote-header {text-align:center; margin-bottom:12px;}
    .vote-title-gradient {
      font-size:2.2rem;
      font-weight:800;
      letter-spacing:2px;
      background: linear-gradient(90deg,#1a237e,#8e24aa,#ff4081);
      background-size:210% 110%;
      background-position: 0 0;
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      animation: textColorfulFlow 7s ease-in-out infinite;
    }
    .vote-desc {text-align:center; margin-bottom:14px; font-size:1.17rem; color:#fff;}
    .subtext {text-align:center; margin-bottom:22px; color:#fff;}
    .vote-grid {display:flex;flex-wrap:wrap;gap:22px;justify-content:center;}
    .vote-card {background:linear-gradient(120deg,#1a237e 7%,#8e24aa 57%,#ff4081 93%);
      color:#fff;border-radius:22px;box-shadow:0 2px 14px #8e24aa77;
      width:210px; min-width:180px; min-height:290px; padding:10px;display:flex;flex-direction:column;align-items:center;transition:box-shadow 0.23s; border:2.5px solid #240c5c; opacity:0.91; cursor:pointer; }
    .vote-card.selected { box-shadow:0 0 36px #8e24aa99; opacity:1; border:3.5px solid #ff4081;}
    .vote-img {width:140px;height:140px;object-fit:cover;border-radius:16px;margin-bottom:10px;}
    .vote-title {margin:7px 0 10px;font-weight:bold;font-size:1.13rem;text-align:center;}
    .vote-info {font-size:0.98rem;text-align:center;color:#fff3;}
    .vote-select {margin:0 0 8px 0;display:none;}
    .stats-bar {display:none;}
    .vote-submit {display:block;margin:29px auto 0 auto;}
    .vote-submit[disabled] {opacity:0.55;filter:grayscale(60%);}
    .chart-section {margin:30px auto 0 auto;max-width:790px;}
    .chart-bar-wrap {position:relative;display:flex;align-items:center;margin-bottom:8px;}
    .chart-bar-label {min-width:120px; font-size:1.05rem;color:#fff;}
    .chart-bar {height:22px; border-radius:14px;background:#1a237e; box-shadow:0 1px 4px #8e24aa44;}
    .chart-bar-inner {height:100%; border-radius:14px;background:linear-gradient(90deg,#8e24aa,#ff4081);}
    .chart-val {margin-left:12px;font-weight:600;color:#fff;}
    .vote-banner {background:linear-gradient(90deg,#1a237e, #8e24aa, #ff4081); color:#fff; font-size:1.13rem; font-weight:500; text-align:center; border-radius:12px; padding:14px; margin-bottom:19px; margin-top:15px; animation:textColorfulFlow 7s infinite;}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="logo-anim">
      <span class="g1">G</span><span class="g2">L</span><span class="g3">O</span><span class="g4">B</span><span class="g5">A</span><span class="g6">L</span>
      <span class="minus">-</span>
      <span class="g7">G</span><span class="g8">A</span><span class="g9">M</span><span class="g10">E</span><span class="g11">S</span>
    </div>
    <nav class="nav-menu">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="contests.html" class="active">My Contests</a></li>
        <li><a href="comingsoon.html">Coming soon</a></li>
      </ul>
    </nav>
  </header>
  <div class="main-content">
    <div class="vote-header">
      <div class="vote-title-gradient">Vote for up to 3 favorites!</div>
      <div class="subtext">Chrismas contest 2025 - by global-games</div>
    </div>
    <div class="vote-grid" id="voteGrid"></div>
    <button class="button-cta vote-submit" id="submitVote" disabled>Submit Vote</button>
    <div class="vote-banner" id="voteBanner" style="display:none">
      Thanks for your vote in the Contest! The results are going to appear on 05.01.2026. The vote in IP secured.
    </div>
    <div class="chart-section" id="chartSection" style="display:none"></div>
  </div>
  <script>
    const options = Array.from({length:20}, (_,i) => ({
      id:"vote"+(i+1),
      title:"Game "+(i+1),
      img:"option"+(i+1)+".jpg",
      info:"Awesome entry "+(i+1)
    }));
    let stats = JSON.parse(localStorage.getItem("globalGames_stats")) || Array(options.length).fill(0);
    let voted = localStorage.getItem("globalGames_voted") === "yes";
    let selected = [];
    const grid = document.getElementById("voteGrid");

    // Build cards
    options.forEach((opt, idx) => {
      let card = document.createElement("div");
      card.className = "vote-card";
      card.id = opt.id;
      card.innerHTML = `
        <img src="${opt.img}" alt="${opt.title}" class="vote-img" onerror="this.style.opacity=0.2">
        <div class="vote-title">${opt.title}</div>
        <div class="vote-info">${opt.info}</div>
        <input type="checkbox" class="vote-select" id="vote_check_${idx}" ${voted ? "disabled" : ""}>`;
      grid.appendChild(card);

      // Card click toggles checkbox
      card.addEventListener("click", function(e) {
        // Prevent click on image from drag/select interfering
        if (voted) return;
        let box = card.querySelector('.vote-select');
        if (!box.checked) {
          if (selected.length < 3) {
            box.checked = true;
            selected.push(idx);
            card.classList.add("selected");
          }
        } else {
          box.checked = false;
          selected = selected.filter(x => x !== idx);
          card.classList.remove("selected");
        }
        document.getElementById("submitVote").disabled = selected.length === 0 || voted;
      });
    });

    // Prevent direct checkbox clicking from breaking logic
    let selects = grid.querySelectorAll('.vote-select');
    selects.forEach((box, idx) => {
      box.addEventListener('click', function(e) {
        e.stopPropagation();
        if (box.checked) {
          if (selected.length < 3) {
            selected.push(idx);
            grid.children[idx].classList.add("selected");
          } else {
            box.checked = false;
          }
        } else {
          selected = selected.filter(x => x !== idx);
          grid.children[idx].classList.remove("selected");
        }
        document.getElementById("submitVote").disabled = selected.length === 0 || voted;
      });
    });

    // Voting logic
    document.getElementById("submitVote").onclick = function() {
      if (voted || selected.length === 0) return;
      selected.forEach(i => stats[i]++);
      localStorage.setItem("globalGames_stats", JSON.stringify(stats));
      localStorage.setItem("globalGames_voted", "yes");
      voted = true;
      for (let el of selects) { el.disabled = true; }
      document.getElementById("submitVote").disabled = true;
      showBanner();
      showChart();
      grid.querySelectorAll('.vote-card').forEach(el => el.classList.remove("selected"));
    };

    if (voted) {
      selects.forEach(box => box.disabled = true);
      showBanner();
      document.getElementById("submitVote").disabled = true;
    }

    // Results Chart
    function showChart() {
      document.getElementById("chartSection").style.display = "";
      let sum = stats.reduce((a, b) => a + b, 0);
      let chart = `<h2 style='background:linear-gradient(90deg,#1a237e,#8e24aa,#ff4081);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>Live results</h2>`;
      options.forEach((opt, idx) => {
        let val = stats[idx] || 0;
        let prc = sum ? Math.round(val / sum * 100) : 0;
        chart += `<div class="chart-bar-wrap">
          <span class="chart-bar-label">${opt.title}</span>
          <div class="chart-bar" style="width:220px;">
            <div class="chart-bar-inner" style="width:${prc * 2}px"></div>
          </div>
          <span class="chart-val">${val} (${prc}%)</span>
        </div>`;
      });
      document.getElementById("chartSection").innerHTML = chart;
    }
    function showBanner() {
      document.getElementById("voteBanner").style.display = "";
    }
  </script>
</body>
</html>
